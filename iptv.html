<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart App Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --red: #e50914; --dark: #0a0a0a; }
        body { margin: 0; background: var(--dark); color: white; font-family: sans-serif; overflow-x: hidden; }
        .page { display: none; padding: 15px; }
        .active { display: block; }
        .header { text-align: center; padding: 20px; color: var(--red); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .box { height: 120px; background: #1a1a1a; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid #333; cursor: pointer; text-align: center; font-weight: bold; }
        .box-large { grid-column: span 2; background: linear-gradient(45deg, #440a0a, var(--red)); height: 100px; font-size: 20px; }
        .list-item { padding: 15px; background: #151515; margin-bottom: 8px; border-radius: 8px; border-left: 4px solid var(--red); cursor: pointer; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #222; color: white; }
        video { width: 100%; aspect-ratio: 16/9; background: #000; }
        .back-btn { background: #333; padding: 10px 20px; border-radius: 20px; display: inline-block; margin: 10px 0; cursor: pointer; font-size: 14px; }
    </style>
</head>
<body>

<div id="home" class="page active">
    <div class="header"><h1>SMART APP</h1><p>Online Player</p></div>
    <div class="grid">
        <div class="box box-large" onclick="loadType('CanlÄ±')">ğŸ“º CANLI YAYIN</div>
        <div class="box" onclick="loadType('Film')">ğŸ¬ FÄ°LMLER</div>
        <div class="box" onclick="loadType('Dizi')">ğŸ­ DÄ°ZÄ°LER</div>
        <div class="box" onclick="showPage('settings')">âš™ï¸ AYARLAR</div>
        <div class="box" onclick="location.reload()">ğŸ”„ YENÄ°LE</div>
    </div>
</div>

<div id="list" class="page">
    <div class="back-btn" onclick="showPage('home')">â¬… GERÄ°</div>
    <h2 id="title">YÃ¼kleniyor...</h2>
    <input type="text" placeholder="Kanal ara..." onkeyup="filter(this.value)">
    <div id="content">LÃ¼tfen bekleyin, veriler Ã§ekiliyor...</div>
</div>

<div id="player" class="page">
    <div class="back-btn" onclick="showPage('list')">â¬… LÄ°STEYE DÃ–N</div>
    <video id="vid" controls autoplay></video>
    <h3 id="playing">OynatÄ±lÄ±yor...</h3>
</div>

<div id="settings" class="page">
    <div class="back-btn" onclick="showPage('home')">â¬… GERÄ°</div>
    <h2>IPTV AYARLARI</h2>
    <input type="text" id="m3uInput" value="http://12345.nobannedle.one:80/get.php?username=haticeferhat709781552&password=hpmk32549j&type=m3u_plus&output=ts">
    <button onclick="saveSettings()" style="width:100%; padding:15px; background:var(--red); border:none; color:white; font-weight:bold; border-radius:8px;">KAYDET VE GÃœNCELLE</button>
</div>

<script>
    let currentData = [];
    let hls = null;

    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id !== 'player' && hls) { document.getElementById('vid').pause(); }
    }

    async function fetchData() {
        const url = document.getElementById('m3uInput').value;
        const proxy = "https://api.allorigins.win/raw?url=";
        
        try {
            const response = await fetch(proxy + encodeURIComponent(url));
            if (!response.ok) throw new Error('Network error');
            const data = await response.text();
            parseM3U(data);
        } catch (err) {
            document.getElementById('content').innerHTML = "Hata: Link yÃ¼klenemedi. AyarlarÄ± kontrol et.";
        }
    }

    function parseM3U(data) {
        currentData = [];
        const lines = data.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF:')) {
                const name = lines[i].split(',')[1] || "Bilinmeyen";
                const streamUrl = lines[i + 1]?.trim();
                if (streamUrl && streamUrl.startsWith('http')) {
                    let type = "CanlÄ±";
                    if (lines[i].toLowerCase().includes('movie') || streamUrl.includes('.mp4')) type = "Film";
                    if (lines[i].toLowerCase().includes('series') || streamUrl.includes('.mkv')) type = "Dizi";
                    currentData.push({ name, url: streamUrl, type });
                }
            }
        }
        document.getElementById('content').innerHTML = "Kanallar hazÄ±r! Kategori seÃ§ebilirsiniz.";
    }

    function loadType(type) {
        showPage('list');
        document.getElementById('title').innerText = type;
        const container = document.getElementById('content');
        container.innerHTML = "";
        
        const filtered = currentData.filter(item => item.type === type);
        if(filtered.length === 0) { container.innerHTML = "Bu kategoride iÃ§erik bulunamadÄ±."; return; }

        filtered.forEach(item => {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerText = item.name;
            div.onclick = () => playVideo(item.url, item.name);
            container.appendChild(div);
        });
    }

    function playVideo(url, name) {
        showPage('player');
        document.getElementById('playing').innerText = name;
        const video = document.getElementById('vid');
        
        if (Hls.isSupported()) {
            if (hls) hls.destroy();
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }

    function saveSettings() {
        fetchData();
        showPage('home');
        alert("Ayarlar gÃ¼ncellendi!");
    }

    function filter(val) {
        const items = document.querySelectorAll('.list-item');
        items.forEach(item => {
            item.style.display = item.innerText.toLowerCase().includes(val.toLowerCase()) ? 'block' : 'none';
        });
    }

    // Ä°lk aÃ§Ä±lÄ±ÅŸta veriyi Ã§ek
    fetchData();
</script>

</body>
</html>
